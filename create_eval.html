<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <script src="js/test.js" defer></script>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

<style>
    .star {
        cursor: pointer;
        font-size: 24px;
        color: black;
    }

    .star.checked {
        color: orange;
    }

</style>
</head>
<body>
<h1>Hello, world!</h1>

<div class="container mt-4">
    <div class="row">
        <!-- You can adjust the column size based on the screen size -->
        <div class="col-12 col-lg-9 mx-auto">
            <div class="card shadow-sm p-4 mb-4">
                <h4 id="currentTime">Current Time: </h4>
                <script>
                    function get_current_time() {
                        const now = new Date();
                        return now.toLocaleTimeString(); // Format the time as HH:MM:SS
                    }

                    // Get the current time and update the card
                    const currentTime = get_current_time();
                    const currentTimeElement = document.getElementById('currentTime');
                    currentTimeElement.textContent = `Current Time: ${currentTime}`;
                </script>
                <form>
                    <div class="form-group">
                        <label class="h1 text-primary">ID:</label>
                        <input type="text" class="form-control" placeholder="Enter ID"/>
                    </div>
                    <div class="form-group">
                        <label class="h2 text-muted">IDM:</label>
                        <input type="text" class="form-control" placeholder="Enter IDM"/>
                    </div>

                </form>

            </div>

            <form id="rating-form" class="mb-5">
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead class="table-dark">
                        <tr>
                            <th>Descripcion</th>
                            <th>Calificacion</th>
                        </tr>
                        </thead>
                        <tbody id="rating_table">
                        <tr class="rating-row">
                            <td>Aire Acondicionado</td>
                            <td>
                                <span class="fa fa-star star" data-value="1"></span>
                                <span class="fa fa-star star" data-value="2"></span>
                                <span class="fa fa-star star" data-value="3"></span>
                                <span class="fa fa-star star" data-value="4"></span>
                                <span class="fa fa-star star" data-value="5"></span>
                            </td>
                        </tr>
                        <tr class="rating-row">
                            <td>Atención del Personal</td>
                            <td>
                                <span class="fa fa-star star" data-value="1"></span>
                                <span class="fa fa-star star" data-value="2"></span>
                                <span class="fa fa-star star" data-value="3"></span>
                                <span class="fa fa-star star" data-value="4"></span>
                                <span class="fa fa-star star" data-value="5"></span>
                            </td>
                        </tr>
                        <tr class="rating-row">
                            <td>Computadoras</td>
                            <td>
                                <span class="fa fa-star star" data-value="1"></span>
                                <span class="fa fa-star star" data-value="2"></span>
                                <span class="fa fa-star star" data-value="3"></span>
                                <span class="fa fa-star star" data-value="4"></span>
                                <span class="fa fa-star star" data-value="5"></span>
                            </td>
                        </tr>
                        <tr class="rating-row">
                            <td>Evaluación Global</td>
                            <td>
                                <span class="fa fa-star star" data-value="1"></span>
                                <span class="fa fa-star star" data-value="2"></span>
                                <span class="fa fa-star star" data-value="3"></span>
                                <span class="fa fa-star star" data-value="4"></span>
                                <span class="fa fa-star star" data-value="5"></span>
                            </td>
                        </tr>
                        <tr class="rating-row">
                            <td>Iluminación</td>
                            <td>
                                <span class="fa fa-star star" data-value="1"></span>
                                <span class="fa fa-star star" data-value="2"></span>
                                <span class="fa fa-star star" data-value="3"></span>
                                <span class="fa fa-star star" data-value="4"></span>
                                <span class="fa fa-star star" data-value="5"></span>
                            </td>
                        </tr>
                        <tr class="rating-row">
                            <td>Limpieza Área</td>
                            <td>
                                <span class="fa fa-star star" data-value="1"></span>
                                <span class="fa fa-star star" data-value="2"></span>
                                <span class="fa fa-star star" data-value="3"></span>
                                <span class="fa fa-star star" data-value="4"></span>
                                <span class="fa fa-star star" data-value="5"></span>
                            </td>
                        </tr>
                        <tr class="rating-row">
                            <td>Limpieza Equipos</td>
                            <td>
                                <span class="fa fa-star star" data-value="1"></span>
                                <span class="fa fa-star star" data-value="2"></span>
                                <span class="fa fa-star star" data-value="3"></span>
                                <span class="fa fa-star star" data-value="4"></span>
                                <span class="fa fa-star star" data-value="5"></span>
                            </td>
                        </tr>
                        <tr class="rating-row">
                            <td>Red Internet</td>
                            <td>
                                <span class="fa fa-star star" data-value="1"></span>
                                <span class="fa fa-star star" data-value="2"></span>
                                <span class="fa fa-star star" data-value="3"></span>
                                <span class="fa fa-star star" data-value="4"></span>
                                <span class="fa fa-star star" data-value="5"></span>
                            </td>
                        </tr>
                        <tr class="rating-row">

                            <td>SW Práctica</td>
                            <td>
                                <span class="fa fa-star star" data-value="1"></span>
                                <span class="fa fa-star star" data-value="2"></span>
                                <span class="fa fa-star star" data-value="3"></span>
                                <span class="fa fa-star star" data-value="4"></span>
                                <span class="fa fa-star star" data-value="5"></span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <button type="submit" class="btn btn-success">Enviar Evaluación</button>
            </form>


        </div>
    </div>
</div>
<script>
    // Get all star elements
    const stars = document.querySelectorAll('.star');

    // Add click event listener to each star
    stars.forEach((star) => {
        star.addEventListener('click', (event) => {
            const clickedStar = event.target;
            const starsContainer = clickedStar.parentElement; // Get the parent containing all stars
            const allStars = starsContainer.querySelectorAll('.star');
            const clickedValue = parseInt(clickedStar.dataset.value, 10);

            // Update the visual state of the stars
            allStars.forEach((star, index) => {
                if (index < clickedValue) {
                    star.classList.add('checked');
                } else {
                    star.classList.remove('checked');
                }
            });
        });
    });

</script>
<script>
    document.getElementById("rating-form").addEventListener("submit", async function (event) {
        event.preventDefault(); // Evitar la recarga de la página

        // Capturar los datos del formulario
        const rows = document.querySelectorAll(".rating-row");
        const evaluacion = {};
        rows.forEach((row) => {
            const descripcion = row.cells[0].textContent.trim().replace(/\s+/g, "");
            const checkedStar = row.querySelector(".star.checked");
            const value = checkedStar ? checkedStar.dataset.value : "0";
            evaluacion[descripcion] = value;
        });

        const fechaHora = new Date().toISOString().replace("T", "-").substring(0, 16);
        const idM = document.querySelector("input[placeholder='Enter IDM']").value.trim();
        const nControl = document.querySelector("input[placeholder='Enter ID']").value.trim();

        // Crear el objeto con el formato requerido
        const data = {
            [nControl]: {
                evaluacion,
                fechaHora,
                idM,
                nControl
            }
        };

        // URL del endpoint
        const url = "https://encuesta-servicios-aldo-default-rtdb.firebaseio.com/evaluaciones22024.json";

        // Enviar la petición PATCH
        try {
            const response = await fetch(url, {
                method: "PATCH",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
            });

            if (response.ok) {
                alert("Evaluación enviada correctamente.");
            } else {
                alert("Error al enviar la evaluación.");
                console.error(await response.text());
            }
        } catch (error) {
            alert("Ocurrió un error al enviar la evaluación.");
            console.error(error);
        }
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
</body>
</html>